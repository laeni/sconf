<nz-layout class="layout-0">
  <nz-header>
    <div class="row no-gutters align-items-center">
      <!--logo-->
      <a class="col-auto" style="width: 2.5em;height: 2.5em;" routerLink="/">
        <svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"
             p-id="1966" width="100%" height="100%">
          <path
            d="M902 684.3H576.3c-7.3 0-13.4-5.9-13.5-13.2v-31.3c0.1-7.3 6.1-13.3 13.5-13.2H902c7.3 0 13.3 5.9 13.4 13.2v31.3c-0.1 7.3-6 13.3-13.4 13.2z m0 115.7H576.3c-7.3 0-13.4-5.9-13.5-13.2v-31.3c0.1-7.3 6.1-13.3 13.5-13.2H902c7.3 0 13.3 5.9 13.4 13.2v31.2c-0.1 7.3-6 13.3-13.4 13.3z m0 115.7H576.3c-7.3 0-13.4-5.9-13.5-13.2v-31.3c0.1-7.3 6.1-13.3 13.5-13.2H902c7.3 0 13.3 5.9 13.4 13.2v31.2c-0.1 7.4-6 13.2-13.4 13.3zM504 621.4v58.7c-94.9 0-172.1-76-172.1-169.4S409.1 341.3 504 341.3c94.9 0 172.1 76 172.1 169.4 0 19.8-3.4 39.4-10.3 57.9h-66.2c11-17.3 16.8-37.4 16.8-57.9 0-60.9-50.5-110.5-112.5-110.5-61.9 0-112.4 49.6-112.4 110.5 0.1 61.1 50.5 110.7 112.5 110.7z m-14.2 235.4c3.7-0.1 7.3 1.4 10.1 4 2.6 2.6 4.2 6.3 4.2 10v30.8c-0.1 7.7-6.4 14-14.2 14h-56.1c-26.7 0.3-49-20.6-50.4-47.2l-8.2-59.4c-24.6-10.3-47.8-23.4-69.2-39.2l-56.2 22.6c-23.9 12.1-53.1 3.7-66.8-19.3l-70.5-119.7c-13.5-22.9-6.3-52.5 16.4-66.6l48.2-36.7a295.5 295.5 0 0 1 0-78.6L129 434.8c-22.5-14-29.8-43.4-16.5-66.3l70.4-119.9c13.7-23 42.8-31.4 66.7-19.4l56.3 22.6c21.3-15.9 44.7-29 69.2-39.2l8.2-59.3c1.4-26.7 23.6-47.6 50.3-47.3h140.7c27 0 49.1 20.7 50.3 47.2l8.2 59.4c24.6 10.2 47.9 23.4 69.3 39.2l56.3-22.5c23.9-11.9 53-3.6 66.7 19.3l70.2 119.8c13.5 22.9 6.4 52.4-16.3 66.6l-48 36.6c3.4 26.1 3.4 52.6 0 78.6l24.3 18.5h-87.9l2.1-11.1c5.9-30.8 5.9-62.7 0-93.6l-3.2-17.4 73.4-55.9-62.8-107.1-85 35.9-13.9-11.7c-24.5-20.3-52.4-36.1-82.4-46.6l-16.9-6.1-12.7-90.3H441.9l-12.5 90.5-16.9 6.1c-30.1 10.6-58 26.4-82.5 46.7l-13.8 11.5-85.8-34.6-62.1 105.6 73.4 55.9-3.2 17.5c-2.9 15.4-4.4 31-4.5 46.7 0.1 15.7 1.6 31.4 4.4 46.8l3.1 17.5-73.3 55.9 63 107.1 84.9-35.9 14 11.6c24.5 20.3 52.4 36.1 82.4 46.6l16.9 6.1 12.5 90.5h47.9z m0 0"
            fill="#ed6c03" p-id="1967"></path>
        </svg>
      </a>
      <!--应用名-->
      <div class="col-auto pl-2">
        <div class="row no-gutters" style="color: #2f8cff">
          <div class="col-auto">{{ client?.name }}</div>
          <div class="col-auto"><i nz-icon nzType="retweet" nzTheme="outline"></i></div>
        </div>
      </div>
    </div>
  </nz-header>
  <nz-layout class="layout-1">
    <nz-sider nzTheme="light" (nzResize)="onSideResize($event)"
              nz-resizable [nzWidth]="siderWidth" [nzMinWidth]="64" [nzMaxWidth]="400"
              (contextmenu)="contextMenu($event,siderMenu)"
    >
      <!--拖拽控制杆-->
      <nz-resize-handle nzDirection="right"></nz-resize-handle>
      <!--region侧边栏右键菜单-->
      <nz-dropdown-menu #siderMenu="nzDropdownMenu">
        <ul nz-menu>
          <li nz-menu-item (click)="openCreateConModal()">创建配置</li>
          <li nz-menu-item (click)="createMenuGroupVisible = true">创建分组</li>
        </ul>
      </nz-dropdown-menu>
      <nz-dropdown-menu #submenuMenu="nzDropdownMenu">
        <ul nz-menu>
          <li nz-menu-item (click)="openCreateConModal()">创建配置</li>
          <li nz-menu-item (click)="createMenuGroupVisible = true">创建分组</li>
          <li *ngIf="!(selectMenu?.children?.length > 0)" nz-menu-item (click)="deleteGroup()">删除此分组</li>
        </ul>
      </nz-dropdown-menu>
      <nz-dropdown-menu #menuMenu="nzDropdownMenu">
        <ul nz-menu>
          <li nz-menu-item (click)="openCreateConModal()">创建配置</li>
          <li nz-menu-item (click)="deleteConf()">删除此配置</li>
          <li nz-menu-item nzDisabled>移动此配置</li>
          <li nz-menu-item (click)="createMenuGroupVisible = true">创建分组</li>
        </ul>
      </nz-dropdown-menu>
      <!--创建分组Modal-->
      <nz-modal *ngIf="client?.nzCascaderOption" [nzVisible]="createMenuGroupVisible"
                (nzOnCancel)="createMenuGroupVisible = false"
                [nzTitle]="null" [nzFooter]="null" [nzMaskClosable]="false">
        <form nz-form #createGroupForm (ngSubmit)="createMenuFormSubmit(group.getSubmitValue(), titleInput.value)">
          <nz-form-item>
            <nz-form-label [nzSpan]="5" nzRequired>分组名</nz-form-label>
            <nz-form-control [nzSpan]="12" nzErrorTip="分组名不能为空">
              <input #titleInput nz-input name="title" required/>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-label [nzSpan]="5">所在分组</nz-form-label>
            <nz-form-control [nzSpan]="12">
              <nz-cascader #group nzChangeOnSelect [nzOptions]="client.nzCascaderOption"
                           name="group" nzPlaceHolder="为空表示添加顶级分组"
              ></nz-cascader>
            </nz-form-control>
          </nz-form-item>
          <nz-form-item>
            <nz-form-control [nzOffset]="5" [nzSpan]="12">
              <button nz-button nzType="primary" [disabled]="!createGroupForm.checkValidity()">提交</button>
            </nz-form-control>
          </nz-form-item>
        </form>
      </nz-modal>
      <!--创建配置-->
      <nz-modal [nzVisible]="createConModalVisible" (nzOnCancel)="createConModalVisible = false"
                [nzTitle]="null" [nzFooter]="null" [nzMaskClosable]="false">
        <form *ngIf="createConForm" nz-form [formGroup]="createConForm" (ngSubmit)="createConfig()">
          <!--配置名称-->
          <nz-form-item>
            <nz-form-label [nzSpan]="5" nzRequired>配置名称</nz-form-label>
            <nz-form-control [nzSpan]="12" nzErrorTip="配置名称不能为空">
              <input nz-input formControlName="name" required placeholder="配置名称"/>
            </nz-form-control>
          </nz-form-item>
          <!--分组-->
          <nz-form-item>
            <nz-form-label [nzSpan]="5">分组</nz-form-label>
            <nz-form-control [nzSpan]="12">
              <nz-cascader nzChangeOnSelect formControlName="group" [nzOptions]="client.nzCascaderOption"
                           name="group" nzPlaceHolder="分组可以为空"
              ></nz-cascader>
            </nz-form-control>
          </nz-form-item>
          <!--类型-->
          <nz-form-item style="margin: 0">
            <nz-form-label [nzSpan]="5">类型</nz-form-label>
            <nz-form-control [nzSpan]="12">
              <nz-radio-group formControlName="type" name="type">
                <label nz-radio nzValue="YAML">yaml</label>
                <label nz-radio nzValue="PROP">properties</label>
                <label nz-radio nzValue="ENUM" nzDisabled>enum</label>
                <label nz-radio nzValue="FILE" nzDisabled>file</label>
              </nz-radio-group>
            </nz-form-control>
          </nz-form-item>
          <div style="color: #5d5d5d;padding: 1em 2em;">
            <span style="font-weight: bold">提示: </span>
            <span>创建配置后需要到配置区设置配置内容并启用后才会生效。</span>
          </div>
          <nz-form-item>
            <nz-form-control [nzOffset]="2" [nzSpan]="15">
              <button nz-button nzType="primary" [disabled]="!createConForm.valid">提交</button>
            </nz-form-control>
          </nz-form-item>
        </form>
      </nz-modal>
      <!--endregion-->

      <!--动态渲染的菜单项-->
      <ul *ngIf="siderWidth > 0 && client?.menusEx" nz-menu nzMode="inline" nzTheme="light">
        <ng-container *ngTemplateOutlet="menuTpl; context: { $implicit: client.menusEx }"></ng-container>
        <ng-template #menuTpl let-menus>
          <ng-container *ngFor="let menu of menus">
            <li *ngIf="menu.confId" nz-menu-item (contextmenu)="contextMenu($event, menuMenu, menu)"
                (click)="clickMenuHandle(menu)"
            >
              <span>{{ menu.title }}</span>
            </li>
            <li *ngIf="!menu.confId" nz-submenu (contextmenu)="contextMenu($event,submenuMenu, menu)"
                [nzTitle]="menu.title">
              <ul style="padding-left: 0.7em">
                <ng-container *ngTemplateOutlet="menuTpl; context: { $implicit: menu.children }"></ng-container>
              </ul>
            </li>
          </ng-container>
        </ng-template>
      </ul>
      <!--空提示-->
      <div *ngIf="siderWidth > 0 && client?.menus.length == 0"
           class="row no-gutters" style="color: #686868;text-align: center;padding: 1em 0.5em;"
      >
        <div class="col-12">啥都没有</div>
        <div class="col-12">赶紧右键添加吧</div>
      </div>
    </nz-sider>
    <nz-layout>
      <nz-content>
        <!--没有选择任何配置时-->
        <div *ngIf="client.confEx.length === 0">{{ client.name }}</div>
        <!--这里为每个配置单独创建一个编辑器实例,防止公用一个实例时出现很多难以解决的问题-->
        <ng-container *ngFor="let conf of client.confEx">
          <ng-container *ngIf="conf.selected">
            <div class="h-100" style="display: flex;flex-wrap: wrap;flex: auto;flex-direction: column;">
              <div class="row no-gutters align-items-center pl-1 pr-1" style="height: 30px;background-color: white;z-index: 1;box-shadow: 0 0 8px 0 rgba(0,0,0,.1);">
                <div class="col-auto pl-1">
                  <nz-switch [(ngModel)]="conf.enableEditor" nzCheckedChildren="启用" nzUnCheckedChildren="禁用"></nz-switch>
                </div>
                <div class="col-auto pl-3">
                  <button *ngIf="conf.checkEditor()" nz-button nzSize="small" nzType="primary"
                          [nzLoading]="conf.submitting" (click)="saveEditor(conf)"
                  >保存</button>
                </div>
              </div>
              <!--YAML | PROP-->
              <div *ngIf="conf?.type === 'YAML' || conf?.type === 'PROP'" style="display: flex;flex-direction: column;flex: auto;">
                <nz-code-editor style="min-height: 100px;border: 1px #dadada solid;"
                                [(ngModel)]="conf.contextEditor" [nzEditorOption]="createConEditorOption"
                                (nzEditorInitialized)="editorInitialized($event)"
                ></nz-code-editor>
              </div>
              <!-- ... -->
            </div>
          </ng-container>
        </ng-container>
      </nz-content>
      <nz-footer>
        sconf ©2020 Laeni
        <a class="p-2" style="color: black;" href="https://github.com/laeni/sconf" target="_blank" rel="noopener">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" class="navbar-nav-svg d-inline-block align-text-top" viewBox="0 0 512 499.36" role="img"><title>GitHub</title><path fill="currentColor" fill-rule="evenodd" d="M256 0C114.64 0 0 114.61 0 256c0 113.09 73.34 209 175.08 242.9 12.8 2.35 17.47-5.56 17.47-12.34 0-6.08-.22-22.18-.35-43.54-71.2 15.49-86.2-34.34-86.2-34.34-11.64-29.57-28.42-37.45-28.42-37.45-23.27-15.84 1.73-15.55 1.73-15.55 25.69 1.81 39.21 26.38 39.21 26.38 22.84 39.12 59.92 27.82 74.5 21.27 2.33-16.54 8.94-27.82 16.25-34.22-56.84-6.43-116.6-28.43-116.6-126.49 0-27.95 10-50.8 26.35-68.69-2.63-6.48-11.42-32.5 2.51-67.75 0 0 21.49-6.88 70.4 26.24a242.65 242.65 0 0 1 128.18 0c48.87-33.13 70.33-26.24 70.33-26.24 14 35.25 5.18 61.27 2.55 67.75 16.41 17.9 26.31 40.75 26.31 68.69 0 98.35-59.85 120-116.88 126.32 9.19 7.9 17.38 23.53 17.38 47.41 0 34.22-.31 61.83-.31 70.23 0 6.85 4.61 14.81 17.6 12.31C438.72 464.97 512 369.08 512 256.02 512 114.62 397.37 0 256 0z"></path></svg>
        </a>
      </nz-footer>
    </nz-layout>
  </nz-layout>
</nz-layout>
